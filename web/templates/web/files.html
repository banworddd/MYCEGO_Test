{% extends "layout.html" %}

{% block title %}–§–∞–π–ª—ã –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–µ{% endblock %}

{% block content %}
    <div class="files-page">
        <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤–≤–æ–¥–∞ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–∞–ø–∫—É –∏–ª–∏ —Ñ–∞–π–ª -->
        <div class="form-container">
            <form method="GET" action="">
                <input type="text" name="folder_link" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –ø–∞–ø–∫—É –∏–ª–∏ —Ñ–∞–π–ª –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞" required>
                <input type="submit" value="–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ">
            </form>
        </div>

        <!-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö –æ —Ñ–∞–π–ª–∞—Ö -->
        {% if files_data %}
            <!-- –ï—Å–ª–∏ —ç—Ç–æ –æ–¥–∏–Ω–æ—á–Ω—ã–π —Ñ–∞–π–ª -->
            {% if files_data.type == 'file' %}
                <h1>–§–∞–π–ª: {{ files_data.name }}</h1>
                <div class="file-container">
                    <div class="file">
                        <input type="checkbox" class="file-checkbox" data-url="{{ files_data.file }}">
                        <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é—à–∫–∏ –∏–ª–∏ –∏–∫–æ–Ω–∫–∏ —Ñ–∞–π–ª–∞ -->
                        {% if files_data.preview %}
                            <img src="{{ files_data.preview }}" alt="{{ files_data.name }}" class="file-preview" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                            <span class="file-icon" style="display: none;">üìÑ</span>
                        {% else %}
                            <span class="file-icon">üìÑ</span>
                        {% endif %}
                        <a href="{{ files_data.file }}" target="_blank">{{ files_data.name }}</a> (—Ñ–∞–π–ª, {{ files_data.size }})
                    </div>
                </div>
            <!-- –ï—Å–ª–∏ —ç—Ç–æ –ø–∞–ø–∫–∞ -->
            {% else %}
                <h1>–ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏: {{ files_data.name }}</h1>
                <!-- –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
                <div class="filter-container">
                    <label for="mime-type-filter">–§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É —Ñ–∞–π–ª–∞:</label>
                    <select id="mime-type-filter">
                        <option value="all">–í—Å–µ —Ñ–∞–π–ª—ã</option>
                        <option value="image">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</option>
                        <option value="video">–í–∏–¥–µ–æ</option>
                        <option value="audio">–ê—É–¥–∏–æ</option>
                        <option value="application">–î–æ–∫—É–º–µ–Ω—Ç—ã</option>
                        <option value="text">–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã</option>
                    </select>
                </div>

                <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ, –µ—Å–ª–∏ –µ—Å—Ç—å -->
                {% if error_message %}
                    <p style="color: red;">–û—à–∏–±–∫–∞: {{ error_message }}</p>
                {% endif %}

                <!-- –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫ -->
                <ul id="file-list">
                    {% for item in files_data.items %}
                        <li class="file-item" data-mime-type="{{ item.mime_type }}">
                            <!-- –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è –ø–∞–ø–∫–æ–π -->
                            {% if item.type == 'dir' %}
                                <div class="folder-container">
                                    <div class="folder-header">
                                        <span class="folder-icon">üìÅ</span>
                                        <span>{{ item.name }}</span>
                                    </div>
                                </div>
                                <div class="folder-content">
                                    {% if item.items %}
                                        {% include "web/folder_content.html" with files_data=item %}
                                    {% endif %}
                                </div>
                            <!-- –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è —Ñ–∞–π–ª–æ–º -->
                            {% else %}
                                <div class="file-container">
                                    <div class="file">
                                        <input type="checkbox" class="file-checkbox" data-url="{{ item.file }}">
                                        <!-- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é—à–∫–∏ –∏–ª–∏ –∏–∫–æ–Ω–∫–∏ —Ñ–∞–π–ª–∞ -->
                                        {% if item.preview %}
                                            <img src="{{ item.preview }}" alt="{{ item.name }}" class="file-preview" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                                            <span class="file-icon" style="display: none;">üìÑ</span>
                                        {% else %}
                                            <span class="file-icon">üìÑ</span>
                                        {% endif %}
                                        <a href="{{ item.file }}" target="_blank">{{ item.name }}</a> (—Ñ–∞–π–ª, {{ item.size }})
                                    </div>
                                </div>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}

            <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ -->
            <button class="download-button" onclick="downloadSelectedFiles()">–°–∫–∞—á–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã</button>
        {% endif %}
    </div>
{% endblock %}
