{% extends "layout.html" %}

{% block title %}–§–∞–π–ª—ã –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–µ{% endblock %}

{% block content %}
    <div class="files-page">
        <div class="form-container">
            <form method="GET" action="">
                <input type="text" name="folder_link" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –ø–∞–ø–∫—É –Ø–Ω–¥–µ–∫—Å.–î–∏—Å–∫–∞" required>
                <input type="submit" value="–ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ">
            </form>
        </div>

        {% if files_data %}
            <h1>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏: {{ files_data.name }}</h1>
            <p>–í–ª–∞–¥–µ–ª–µ—Ü: {{ files_data.owner }}</p>

            <!-- –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
            <div class="filter-container">
                <label for="mime-type-filter">–§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É —Ñ–∞–π–ª–∞:</label>
                <select id="mime-type-filter">
                    <option value="all">–í—Å–µ —Ñ–∞–π–ª—ã</option>
                    <option value="image">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</option>
                    <option value="video">–í–∏–¥–µ–æ</option>
                    <option value="audio">–ê—É–¥–∏–æ</option>
                    <option value="application">–î–æ–∫—É–º–µ–Ω—Ç—ã</option>
                    <option value="text">–¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã</option>
                </select>
            </div>

            {% if error_message %}
                <p style="color: red;">–û—à–∏–±–∫–∞: {{ error_message }}</p>
            {% endif %}

            <ul id="file-list">
                {% for item in files_data.items %}
                    <li class="file-item" data-mime-type="{{ item.mime_type }}">
                        {% if item.type == 'dir' %}
                            <div class="folder-container">
                                <div class="folder-header">
                                    <span class="folder-icon">üìÅ</span>
                                    <span>{{ item.name }}</span>
                                </div>
                            </div>
                            <div class="folder-content">
                                {% if item.items %}
                                    {% include "web/folder_content.html" with files_data=item %}
                                {% endif %}
                            </div>
                        {% else %}
                            <div class="file-container">
                                <div class="file">
                                    <input type="checkbox" class="file-checkbox" data-url="{{ item.file }}">
                                    {% if item.preview %}
                                        <img src="{{ item.preview }}" alt="{{ item.name }}" class="file-preview" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                                        <span class="file-icon" style="display: none;">üìÑ</span>
                                    {% else %}
                                        <span class="file-icon">üìÑ</span>
                                    {% endif %}
                                    <a href="{{ item.file }}" target="_blank">{{ item.name }}</a> (—Ñ–∞–π–ª, {{ item.size }})
                                </div>
                            </div>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>

            <button class="download-button" onclick="downloadSelectedFiles()">–°–∫–∞—á–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã</button>
        {% endif %}
    </div>
{% endblock %}